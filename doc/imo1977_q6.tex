
\section{IMO 1977 Q6}

En esta sección se va a detallar la solución al problema Q6 que se
propuso en el año 1977. Comenzaremos presentando el enunciado de dicho
problema y su correspondiente solución en lenguaje
natural. Posteriormente se presentará la formalización en Lean de dicho
problema y el análisis de ésta.

Destacar que la formalización original del problema se ha obtenido de
\cite{TC} y fue propuesta por Tian Chen.

\noindent
\framebox{\parbox{\textwidth}{
    \textbf{Problema 1 (1977--Q6)}. Consideremos la función
    \(f:ℕ⁺ → ℕ⁺\) satisfaciendo que
    \[f(f(n))<f(n+1)\]
    para cualquier número \(n\). Probar que para todo número
    natural positivo \(n\) se verifica que
  \[f(n)=n.\]}}

Para llevar a cabo la formalizaciṕon en Lean del problema que
se ha planteado, se va a importar la teoría
\href{https://github.com/leanprover-community/mathlib/blob/
  master/src/data/pnat/basic.lean}{data.pnat.basic} sobre el conjunto
formado por los números naturales que son positivos.

En Lean esto lo expresamod como sigue:
\begin{leancode}
import data.pnat.basic
\end{leancode}

Para llevar a cabo la resolución del problema que se nos plantea,
se va introducir un teorema auxiliar, el cual consistirá en
demostrar el mismo resultado que se nos plantea pero para una
función que está definida en todo el conjunto de los números
naturales. Enunciemos dicho teorema:

\begin{teorema}[Extension]\label{extension}
  Sea \(f:ℕ → ℕ\) una función satisfaciendo que
  \begin{equation}
    f(f(n))<f(n+1)
  \end{equation}
  para cualquier número natural \(n\). Entonces se tiene que
  para todo número natural \(n\) se verifica que
  \begin{equation}
    f(n)=n.
  \end{equation}
\end{teorema}
\begin{demostracion}
  Suponiendo que se tiene una función definida entre el conjunto
  de los números naturales, es decir, \(f: ℕ → ℕ\), verificando
  que
  \begin{equation}\label{h1}\tag{h1}
     f(f(n))<f(n+1);
  \end{equation}
  se tiene que demostrar que para cualquier número natural se cumple
  que \(f(n)\) es igual a \(n\). Simbólicamente:
  \begin{equation}
    ∀ n, f(n)=n.
  \end{equation}

  Previo a la demostración en sí de este resultado, se va a probar
  un resultado auxiliar que nos será necesario para la conclusión
  del primero. Destacar que este teorema auxiliar se va a demostrar
  bajo las condiciones que se encuentra el problema.

  Hay que demostrar que dados dos números naturales cualesquiera
  \(k,n\) tales que \(k\) es menor o igual que \(n\). Entonces
  se tiene que \(k\) es menor o igual que \(f(n)\). Simbólicamente:
  \begin{equation}\label{h2}\tag{h2}
    ∀ k, n ∈ ℕ, k≤ n ⟶ k ≤ f(n).
  \end{equation}

  Para demostrar (\ref{h2}), aplicaremos el método de inducción
  en el número natural \(k\):

  Probar por inducción en \(k\) el resultado consiste en demostrar
  que para el caso en el que \(k\) es nulo y que suponiendo que se
  verifica para \(k\), entonces se verifica para \(k\) más uno.
  Distingamos entonces los casos:
  
  \begin{itemize}
    \item \textbf{Caso \(k=0\).}

      En este caso, hay que demostrar que
      \begin{equation}\label{dem}
        0≤f(n),
      \end{equation}
      bajo las hipótesis (\ref{h1}) y que para todo número natural
      \(n\) se verifica que
      \begin{equation}
        0≤ n. 
      \end{equation}

      Para demostrar (\ref{dem}) basta con aplicar que por
      definición todo número natural es mayor igual que cero.
      Entonces, como consecuencia de que la función \(f\) está
      definida entre el conjunto de los números naturales, se tiene
      que \(f(n)\) siempre va a ser mayor o igual que cero para
      cualquier \(n\) natural.
      
    \item \textbf{Caso \(k+1\).}
    
      En este caso, asumiendo como cierta la hipótesis de inducción,
      es decir, suponiendo que se verifica que
      \begin{equation}\label{hind}\tag{h\(\_\)ind}
        ∀ n ∈ ℕ, k≤ n ⟶ k ≤ f(n),
      \end{equation}
      hay que demostrar que para todo número natural \(n\) tal que
      sea mayor o igual que \(k+1\), entonces se verifica que
      \begin{equation}\label{hind2}
        k+1 ≤ f(n).
      \end{equation}

      Una vez ya se ha introducido la hipótesis de inducción, se va
      a denotar la hipótesis de que para cualquiero número natural
      \(n\) sea mayor igual que \(k+1\) como:
      \begin{equation}\label{hk}\tag{hk}
        k+1≤n.
      \end{equation}

      Ahora bien, demostrar (\ref{hind2}) es equivalente a demostrar
      que \(k\) sea menor entricto que \(f(n)\), esto es:
      \begin{equation}\label{hind3}
        k<f(n).
      \end{equation}

      A continuación, se van a deducir una serie de hipótesis que se
      tienen de manera casi directa y que nos ayudarán a la
      resolución del problema principal.
      \begin{itemize}
      \item A partir de la hipótesis (\ref{hk}), se tiene de manera
        directa que pasando restando el uno de una parte de la
        desigualdad a otra, se tiene que
        \begin{equation}\label{hk1}\tag{hk1}
          k≤n-1.
        \end{equation}
        
      \item Haciendo uso ahora de la hipótesis de inducción,
        (\ref{hind}), y de la hipótesis anteriormente deducida,
        (\ref{hk1}), se puede deducir que
        \begin{equation}\label{hk2}\tag{hk2}
          k≤f(n-1).
        \end{equation}

      \item De manera totalmente análoga en como se ha deducido
        la hipótesis (\ref{hk2}), se puede deducir que
        \begin{equation}\label{hk3}\tag{hk3}
          k≤f(f(n-1)),
        \end{equation}
        sin más que aplicar la hipótesis de inducción, (\ref{hind}),
        y el resultado anteriormente deducido, (\ref{hk2}).

      \item La última hipótesis que introduciremos en este apartado,
        será haciendo uso de la hipótesis principal del teorema,
        es decir, (\ref{h1}). Se particularizará para el caso en el
        que se considera \(n-1\), de esta forma se tendría:
        \begin{equation}\label{exph11}
          f(f(n-1))<f(n-1+1).
        \end{equation}

        Ahora bien, la expresión (\ref{exph11}) se puede reescribir
        como
        \begin{equation}\label{h11}\tag{h11}
          f(f(n-1))<f(n).
        \end{equation}
        Esta reescritura se ha llevado a cabo mediante el uso de
        la cancelación en la suma de los números naturales, esto es:

        \begin{proposicion}\label{sumanat}
          Sean \(m\) y \(n\) dos números pertenecientes al conjunto
          de los números naturales tales que \(m\) es menor o igual
          que \(n\). Entonces se tiene que si al número \(n\) le
          restamos y sumamos el número \(m\) el resultado que se
          obtiene es \(n\). Simbólicamente:
          \begin{equation}
            ∀n,m ∈ ℕ, m≤n ⟶ n-m+m=n.
          \end{equation}
        \end{proposicion}

        La formalización en Lean de esta proposición es la que se
        presente a continuación:
        \begin{leancode}
          theorem sub_add_cancel {n m : ℕ} (h : m ≤ n) : n - m + m = n 
        \end{leancode}
      \end{itemize}

      De esta forma, al haber hecho uso de la proposición \ref{sumanat}, el objetivo a demostrar que antes era (\ref{hind3}), ahora se
      le añade otro nuevo objetivo y es demostrar que además se
      cumple que el número natural \(n\) es mayor o igual que \(1\),
      esto es:
      \begin{equation}\label{n1}
        n≥1.
      \end{equation}

      Por claridad en la notación, estos dos objetivos mencionados
      se van a dividir en dos problemas diferentes:
      \begin{enumerate}
      \item \textbf{Problema 1}

        Demostrar (\ref{hind3}) es bastante sencillo con ayuda de
        las hipótesis deducidas anteoriormente. Veámoslo:
        \begin{equation}
          k\stackrel{(*)}{≤}f(f(n-1))\stackrel{(**)}{<}f(n),
        \end{equation}
        donde en \((*)\) se ha hecho uso de la hipótesis (\ref{hk3})
        y en \((**)\) se ha usado la hipótesis (\ref{h11}).

      \item \textbf{Problema 2}

        Ahora se tiene que demostrar (\ref{n1}) también bajo todas
        las hipótesis que se han deducido posteriormente. Aunque
        realmente para probar este resultado no son necesarias,
        sólo se necesitan los dos siguientes resultados generales
        de los números naturales:

        \begin{lema}\label{lemaNatCero}
          Sea \(n\) un número natural cualquiera, entonces dicho
          número \(n\) es mayor o igual que cero.
        \end{lema}

        Cuya formalización en Lean es:
        \begin{leancode}
          lemma zero_le : ∀ (n : ℕ), 0 ≤ n
        \end{leancode}

        \begin{lema}\label{lemaNatSuc}
          Sean \(n\) y \(m\) dos números naturales tales que \(n\)
          es menor o igual que \(m\). Entonces se tiene que el
          número natural sucesor de \(n\) (es decir, \(n+1\)) es
          menor o igual que el sucesor de \(m\). Simbólicamente:
          \begin{equation}
            ∀n,m ∈ ℕ, n≤m ⟶ n+1≤m+1.
          \end{equation}
        \end{lema}

        Y la formalización en Lean de este lema es la siguiente:
        \begin{leancode}
          lemma succ_le_succ {n m : ℕ} : n ≤ m → succ n ≤ succ m
        \end{leancode}

        De esta forma se tendría que si consideramos un número
        natural \(k\), haciendo uso del lema \ref{lemaNatCero}, se
        tiene que
        \begin{equation}\label{k0}
          k≥0.
        \end{equation}

        Si además, ahora se hace uso del lema \ref{lemaNatSuc}
        considerando los números naturales \(k\) y \(0\) y la
        hipótesis (\ref{k0}), se puede concluir que
        \begin{equation}\label{hk0}\tag{hk0}
          1≤k+1
        \end{equation}

        Ahora bien, para finalizar la prueba de este problema basta
        con aplicar la transitividad de las relaciones menor o igual
        y menor sobre las hipótesis (\ref{hk}) y (\ref{hk0}).

      \end{enumerate}

    Una vez ya se han demostrado los objetivos (\ref{hind3}) y
    (\ref{n1}), se tiene que ya se ha probado el caso \(k+1\) del
    método de inducción.
    \end{itemize}

  De esta forma, tras haber terminado la prueba de la hipótesis
  (\ref{h2}) por el método de inducción, se procederá a la
  continuación de la prueba. 

  Para ello, se continuará demostrarando que para cualquier número
  natural \(n\)
\end{demostracion}

La formalización en Lean de este teorema sería la siguiente:
\begin{leancode}
theorem Extension
  (f : ℕ → ℕ)
  (h1 : ∀ n, f (f n) < f (n + 1))
  : ∀ n, f n = n :=
begin
  have h2: ∀ (k n : ℕ), k ≤ n → k ≤ f n,
  { intro k,
     induction k with k h_ind,
     { intros n hn,
       exact nat.zero_le (f n), },
     { intros n hk,
       apply nat.succ_le_of_lt,
       rw nat.succ_eq_add_one at hk,
       have hk1: k ≤ n-1 := nat.le_sub_right_of_add_le hk,
       have hk2: k ≤ f (n-1):= h_ind (n-1) hk1,
       have hk3: k ≤ f(f(n-1)) := h_ind (f(n-1)) hk2,
       have h11: f (f (n-1)) < f(n-1+1):= h1 (n-1),
       rw nat.sub_add_cancel at h11,
       { calc k ≤ f(f(n-1)) : hk3
            ... < f(n)      : h11,},
       have hk0: 1 ≤ k+1 := nat.succ_le_succ (nat.zero_le k),
       exact (le_trans hk0 hk), }},
  have hf: ∀ n, n ≤ f n,
    { intro n,
      apply h2 n n,
      exact le_rfl, },
  have mon: ∀ n, f n < f(n+1),
    { intro n,
      exact lt_of_le_of_lt (hf (f n)) (h1 n), },
  have f_mon: strict_mono f := strict_mono.nat mon,
  intro n,
  apply nat.eq_of_le_of_lt_succ (hf n),
  exact (f_mon.lt_iff_lt.mp (h1 n)),
end
\end{leancode}

Una vez ya se ha demostrado el teorema \ref{extension}, se va a
introducir el teorema con el cual el problema estaría resuleto.
El teorema que introduciremos a continuación, no es más que un caso3
particular del anterior.


\begin{teorema}[imo1977\(\_ \)q62]
  Sea \(f:ℕ⁺ → ℕ⁺\) una función satisfaciendo que
  \begin{equation}
    f(f(n))<f(n+1)
  \end{equation}
  para cualquier número natural positivo \(n\). Entonces se tiene
  que para todo número natural positivo \(n\) se verifica que
  \begin{equation}
    f(n)=n.
  \end{equation}
\end{teorema}
\begin{demostracion}
hola
\end{demostracion}

Finalmente, la formalización en Lean de este teorema nos quedaría:
\begin{leancode}
theorem imo1977_q62 (f : ℕ+ → ℕ+) (h : ∀ n, f (f n) < f (n + 1)) :
  ∀ n, f n = n :=
begin
  intro n,
  simpa using Extension (λ m, if 0 < m then f m.to_pnat' else 0) _ n,
  intro x,
  cases x,
  {simp},
  {simpa using h _},
end
\end{leancode}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "IMO_en_Lean"
%%% End:
